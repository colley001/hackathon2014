<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet"
	href="http://dojotoolkit.org/reference-guide/1.9/_static/js/dojo/../dijit/themes/claro/claro.css">
<style type="text/css">
.transactionRecord {
	border: 1px;
	margin: 1em;
}

.offerRecord {
	border: 1px;
}

.employeeName {
	color: blue;
}

.specialEmployeeName {
	color: red;
}

.titleClass {
	color: blue;
}

.tundra .dijitSelect .dijitButtonText {
	text-align: left;
}

.tundra .dijitSelectLabel {
	width: 120px;
	overflow: hidden;
}
</style>
<script>
	dojoConfig = {
		parseOnLoad : true
	}
</script>
<script
	src='http://dojotoolkit.org/reference-guide/1.9/_static/js/dojo/dojo.js'></script>

<script>
	require([ "dijit/form/Select", "dojo/domReady!" ], function() {

	});
</script>
<script>
	// **************************************
	// ****** TRANSACTION RECORD COMPONENT
	// **************************************
	require(
			[ "dojo/_base/declare", "dojo/parser", "dojo/ready",
					"dijit/_WidgetBase", "dijit/_TemplatedMixin", "dojo/dom",
					"dojo/parser", "dijit/form/Button" ],
			function(declare, parser, ready, _WidgetBase, _TemplatedMixin) {

				declare(
						"TransactionRecord",
						[ _WidgetBase, _TemplatedMixin ],
						{
							templateString : "<div class='transactionRecord'>"
									+ "<div><span data-dojo-attach-point='descNode'></span> <span data-dojo-attach-point='dateNode'></span></div>"
									+ "<div>Debit Currency: <span data-dojo-attach-point='debitCurrencyNode'></span></div>"
									+ "<div>Payment: <span data-dojo-attach-point='paymentAmountNode'></span> <span data-dojo-attach-point='paymentCurrencyNode'></span></div>"
									+ "<div>City : <span data-dojo-attach-point='cityNode'></span> Country : <span data-dojo-attach-point='countryNode'></span></div>"
									+ "<div>Fee : <span data-dojo-attach-point='feeAmountNode'></span>  <span data-dojo-attach-point='feeCurrencyNode'></span></div>"
									+ "</div>",

									
									
							// Attributes
							Desc : "unknown",
							_setDescAttr : {
								node : "descNode",
								type : "innerHTML"
							},
							
							DebitCurrency : "unknown",
							_setDebitCurrencyAttr : {
								node : "debitCurrencyNode",
								type : "innerHTML"
							},
							
							PaymentCurrency : "unknown",
							_setPaymentCurrencyAttr : {
								node : "paymentCurrencyNode",
								type : "innerHTML"
							},
							PaymentAmount : "unknown",
							_setPaymentAmountAttr : {
								node : "paymentAmountNode",
								type : "innerHTML"
							},
							
							
							Date : "unknown",
							_setDateAttr : {
								node : "dateNode",
								type : "innerHTML"
							},

							DescClass : "employeeName",
							_setDescClassAttr : {
								node : "descNode",
								type : "class"
							},

							City : "unknown",
							_setCityAttr : {
								node : "cityNode",
								type : "innerHTML"
							},
							Country : "unknown",
							_setCountryAttr : {
								node : "countryNode",
								type : "innerHTML"
							},
							FeeAmount : "unknown",
							_setFeeAmountAttr : {
								node : "feeAmountNode",
								type : "innerHTML"
							},
							FeeCurrency : "unknown",
							_setFeeCurrencyAttr : {
								node : "feeCurrencyNode",
								type : "innerHTML"
							}
						});

			});
</script>
<script>
	// **************************************
	// ****** OFFER COMPONENT
	// **************************************
	require(
			[ "dojo/_base/declare", "dojo/parser", "dojo/ready",
					"dijit/_WidgetBase", "dijit/_TemplatedMixin", "dojo/dom",
					"dojo/parser", "dijit/form/Button" , "dijit", "dojo/dom"],
			function(declare, parser, ready, _WidgetBase, _TemplatedMixin) {

				declare(
						"OfferRecord",
						[ _WidgetBase, _TemplatedMixin ],
						{
							templateString : "<div class='offerRecord'>"
									+ "<div><span data-dojo-attach-point='titleNode'></span></div>"
									+ "<div><span data-dojo-attach-point='descNode'></span></div>"
									+ "</div>",

							// Attributes
							title : "unknown",
							_setTitleAttr : {
								node : "titleNode",
								type : "innerHTML"
							},

							titleClass : "titleClass",
							_setTitleClassAttr : {
								node : "titleNode",
								type : "class"
							},

							desc : "unknown",
							_setDescAttr : {
								node : "descNode",
								type : "innerHTML"
							}
						});
				

			});
</script>
<script>

		
</script>
<script>
	//data
	accounts = [
   {
	      "desc": "Super Ease",
	      "hasParent": false,
	      "ccy": {
	         "desc": "",
	         "code": "HKD"
	      },
	      "accountNum": "001-029784-288",
	      "type": "SEE",
	      "id": "001029784288~~SS~~SEE~~HKD~~Super Ease~~DDA~~2C288HKD       HKDSSSEE",
	      "balance": "-3,998.45",
	      "drCr": true,
	      "hasAcctDtl": true
	   },
	   {
	      "desc": "HSBC Premier",
	      "hasParent": false,
	      "ccy": {
	         "desc": "",
	         "code": "HKD"
	      },
	      "accountNum": "001-072487-888",
	      "type": "MST",
	      "id": "001072487888~~AV~~MST~~HKD~~HSBC Premier~~DDA~~2B888HKD       HKDAVMST",
	      "balance": "",
	      "drCr": false,
	      "hasAcctDtl": false
	   },
	   {
	      "desc": "HKD Savings",
	      "hasParent": true,
	      "ccy": {
	         "desc": "",
	         "code": "HKD"
	      },
	      "accountNum": "001-072487-888",
	      "type": "SAV",
	      "id": "001072487888~~AV~~SAV~~HKD~~HSBC Premier HKD Savings~~DDA~~2A888HKD       HKDAVSAV",
	      "balance": "68,776,514.04",
	      "drCr": false,
	      "hasAcctDtl": true
	   },
	   {
	      "desc": "GBP Savings",
	      "hasParent": true,
	      "ccy": {
	         "desc": "",
	         "code": "GBP"
	      },
	      "accountNum": "001-072487-888",
	      "type": "SAV",
	      "id": "001072487888~~AV~~SAV~~GBP~~HSBC Premier GBP Savings~~DDA~~2F888GBP       GBPAVSAV",
	      "balance": "Balance Not Available",
	      "drCr": false,
	      "hasAcctDtl": false
	   },
	   {
	      "desc": "SGD Savings",
	      "hasParent": true,
	      "ccy": {
	         "desc": "",
	         "code": "SGD"
	      },
	      "accountNum": "001-072487-888",
	      "type": "SAV",
	      "id": "001072487888~~AV~~SAV~~SGD~~HSBC Premier SGD Savings~~DDA~~2F888SGD       SGDAVSAV",
	      "balance": "Balance Not Available",
	      "drCr": false,
	      "hasAcctDtl": false
	   },
	   
	   {
	      "desc": "Investment Services",
	      "hasParent": true,
	      "ccy": {
	         "desc": "",
	         "code": "HKD"
	      },
	      "accountNum": "001-072487-888",
	      "type": "INV",
	      "id": "001072487888~~AV~~INV~~HKD~~HSBC Premier Investment Services~~DDA~~2R888HKD       HKDAVINV",
	      "balance": "Balance Not Available",
	      "drCr": false,
	      "hasAcctDtl": false
	   },
	   {
	      "desc": "USD Savings",
	      "hasParent": true,
	      "ccy": {
	         "desc": "",
	         "code": "USD"
	      },
	      "accountNum": "004-291209-888",
	      "type": "SAV",
	      "id": "004291209888~~AV~~SAV~~USD~~HSBC Premier USD Savings~~DDA~~2F888USD       USDAVSAV",
	      "balance": "82,751.56",
	      "drCr": false,
	      "hasAcctDtl": true
	   },
	   {
	      "desc": "Time Deposit",
	      "hasParent": true,
	      "ccy": {
	         "desc": "",
	         "code": "   "
	      },
	      "accountNum": "004-291209-888",
	      "type": "TMS",
	      "id": "0042912098880000~~AV~~TMS~~   ~~HSBC Premier Time Deposit~~DDA~~4T888             AVTMS",
	      "balance": "Details",
	      "drCr": false,
	      "hasAcctDtl": true
	   },
	   {
	      "desc": "Statement Gold",
	      "hasParent": false,
	      "ccy": {
	         "desc": "",
	         "code": "MACE"
	      },
	      "accountNum": "068-000934-261",
	      "type": "GLD",
	      "id": "068000934261~~SS~~GLD~~GLT~~Statement Gold~~DDA~~2W261GLT       GLTSSGLD",
	      "balance": "0",
	      "drCr": false,
	      "hasAcctDtl": true
	   }
	]

	transactions = [ 
   {
      "ID": "12345",
      "Desc": "Buying 10 units of X",
      "Date": "20140611",
      "PyeeInfo": {
         "pyeeDetlInfo": {
            "pyeeDetlInfo": {
               "pyeeTyp": "Personal",
               "pyeeID": "1",
               "pyeeName": "Mary Smith",
               "pyeeCtry": "UK",
               "pyeeAddr": {
                  "addrFrmtTyp": "Address line 1 (Mandatory) •   Address line 2 (Optional) •   Address line 3 (Optional) •   Country (Mandatory)  Format B •  Address line 1 (Mandatory) •   Address line 2 (Optional) •   City (Mandatory) •   Province/State (Optional) •   Postal Code/Zip Code (Optional) •   Country (Mandatory)",
                  "line1": "Unit 7",
                  "line2": "123 Abc Street",
                  "city": "London",
                  "prov": "England",
                  "postalCde": "E14 8K8",
                  "ctryCde": "UK"
               }
            },
            "pyeeFinInstInfo": {
               "bankName": "Citibank",
               "bankCdeTyp": "1",
               "bankCde": "12345",
               "acctNum": "111-222222-333",
               "acctCcy": "GBP",
               "prodCatCde": "DDA",
               "bankAddr": {
                  "addrFrmtTyp": "Address line 1 (Mandatory) •   Address line 2 (Optional) •   Address line 3 (Optional) •   Country (Mandatory)  Format B •  Address line 1 (Mandatory) •   Address line 2 (Optional) •   City (Mandatory) •   Province/State (Optional) •   Postal Code/Zip Code (Optional) •   Country (Mandatory)",
                  "line1": "Citibank",
                  "line2": "1 Bank Street",
                  "city": "London",
                  "prov": "Endland",
                  "postalCde": "SW1 1N1",
                  "ctryCde": "UK"
               }
            }
         }
      },
      "TxnDetails": {
         "debitAcctCcy": "GBP",
         "paymentCcy": "GBP",
         "txnAmt": {
            "amt": "100",
            "ccy": "GBP"
         }
      },
      "TxnSchedDtl": {
         "txnSchedTyp": "PN",
         "txnSchedDate": ""
      },
      "ChrgType": {
         "chargeTye": "1",
         "chargeAcct": "1",
         "Fee": {
            "amt": "10",
            "ccy": "GBP"
         }
      }
   },
   {
      "ID": "12346",
      "Desc": "Buying 10 units of X",
      "Date": "20140611",
      "PyeeInfo": {
         "pyeeDetlInfo": {
            "pyeeDetlInfo": {
               "pyeeTyp": "Corporate",
               "pyeeID": "2",
               "pyeeName": "XYZ Shop",
               "pyeeCtry": "France",
               "pyeeAddr": {
                  "addrFrmtTyp": "Address line 1 (Mandatory) •   Address line 2 (Optional) •   Address line 3 (Optional) •   Country (Mandatory)  Format B •  Address line 1 (Mandatory) •   Address line 2 (Optional) •   City (Mandatory) •   Province/State (Optional) •   Postal Code/Zip Code (Optional) •   Country (Mandatory)",
                  "line1": "Unite1",
                  "line2": "123 Abc Street",
                  "city": "Paris",
                  "prov": "France",
                  "postalCde": "E14 8K8",
                  "ctryCde": "FR"
               }
            },
            "pyeeFinInstInfo": {
               "bankName": "BNP Paris Bas",
               "bankCdeTyp": "2",
               "bankCde": "12346",
               "acctNum": "111-222222-334",
               "acctCcy": "EUR",
               "prodCatCde": "DDA",
               "bankAddr": {
                  "addrFrmtTyp": "Address line 1 (Mandatory) •   Address line 2 (Optional) •   Address line 3 (Optional) •   Country (Mandatory)  Format B •  Address line 1 (Mandatory) •   Address line 2 (Optional) •   City (Mandatory) •   Province/State (Optional) •   Postal Code/Zip Code (Optional) •   Country (Mandatory)",
                  "line1": "BNP Paris Bas",
                  "line2": "1 Bank Street",
                  "city": "Paris",
                  "prov": "France",
                  "postalCde": "SW1 1N1",
                  "ctryCde": "FR"
               }
            }
         }
      },
      "TxnDetails": {
         "debitAcctCcy": "EUR",
         "paymentCcy": "GBP",
         "txnAmt": {
            "amt": "100000",
            "ccy": "GBP"
         }
      },
      "TxnSchedDtl": {
         "txnSchedTyp": "PN",
         "txnSchedDate": ""
      },
      "ChrgType": {
         "chargeTye": "1",
         "chargeAcct": "1",
         "Fee": {
            "amt": "100",
            "ccy": "GBP"
         }
      }
   }
	];

	offers = [ {
		"title" : "Special Offer No1",
		"desc" : "<p>The special offer....</p><p>Must be in new paragraph</p>"
	}, {
		"title" : "Special Offer No2",
		"desc" : "<p>The special offer....</p><p>Must be in new paragraph</p>"
	}
	/* More authors here... */
	]
</script>
</head>
<body class="claro">
	<div style="border: solid black 1px; width: 900px;">
		<div data-dojo-type="dijit/TitlePane"
			data-dojo-props="title: 'Abroad Payments'">
			<table>
				<tr>
					<td width="300px">
						<div data-dojo-type="dijit/layout/ContentPane"
							data-dojo-props="region:'left'">
							<div data-dojo-type="dijit/layout/ContentPane">
								Select Account:<br /> <select id="accountSelect"
									name="accountSelect" data-dojo-type="dijit/form/Select"
									style="width: 300px;">

								</select>
							</div>
							<div data-dojo-type="dijit/layout/ContentPane"
								id="transactionsPanel"></div>
						</div>
					</td>
					<td width="600px">
						<div data-dojo-type="dijit/layout/ContentPane"
							data-dojo-props="region:'right'">
							<div data-dojo-type="dijit/layout/ContentPane" id="offersPanel">
							<div> </div>
							<div> </div>
							</div>
							<div data-dojo-type="dijit/layout/ContentPane" id="map">MAP</div>
						</div>
					</td>
				</tr>
			</table>
		</div>
	</div>
	<button data-dojo-type="dijit/form/Button" type="button">
		Click me too!
		<script type="dojo/on" data-dojo-event="click" data-dojo-args="evt">
        require(["dojo/dom", "dojo/_base/array", "dijit", "dojo/on"], function(dom, array, dijit){
			//load select account
			var accountSelect = dijit.byId('accountSelect');
			array.forEach(accounts, function(record) {
				// Create our widget and place it
				accountSelect.addOption( { "label": record.desc + " " + record.accountNum, "value" : record.id});
			});

			accountSelect.onChange = function() {
				
				dojo.empty("transactionsPanel");
				
            	var transactionPanel = dom.byId("transactionsPanel");
			
 				array.forEach(transactions, function(record) {
				// Create our widget and place it
				var widget = new TransactionRecord({Desc : record.Desc, 
													DebitCurrency : record.TxnDetails.debitAcctCcy,
													PaymentCurrency:  record.TxnDetails.paymentCcy, 
													Date : record.Date,
													PaymentAmount : record.TxnDetails.txnAmt.amt,
													City : record.PyeeInfo.pyeeDetlInfo.pyeeDetlInfo.pyeeAddr.city,
													Country : record.PyeeInfo.pyeeDetlInfo.pyeeDetlInfo.pyeeAddr.prov,
													FeeAmount :  record.ChrgType.Fee.amt,
													FeeCurrency : record.ChrgType.Fee.ccy}).placeAt(transactionPanel);
				 widget.onmouseover = function() {
								//TODO: real action - queries payments
								dojo.empty("offersPanel");
								var offersContainer = dom.byId("offersPanel");
									array.forEach(offers, function(record) {
									// Create our widget and place it
									var widget = new OfferRecord(record).placeAt(offersContainer);
								});
				};
								
			});
			}


        });
    </script>
	</button>
</body>
</html>